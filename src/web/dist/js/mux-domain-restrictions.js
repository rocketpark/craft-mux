import{d as e,r as t,t as a,o as n,c as o,a as i,f as r,v as s,u as l,x as c,w as d,y as u,g as p,F as m,p as f,n as b,k as h,l as y,s as w}from"./vue.esm-bundler.js";import{u as g}from"./index2.js";const x=e({restrictions:[],loading:!1,params:{limit:50,page:1}});function k(){x.loading=!0;const e=new URLSearchParams(x.params).toString();fetch(`/actions/mux/settings/use-playback-restrictions-list?${e}`).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{e.success&&(x.restrictions=e.result.data),x.loading=!1})).catch((e=>{x.loading=!1,console.error("There was a problem with the usePlaybackRestrictionsList fetch operation:",e)}))}const v=["data-id"],P={class:"undefined singleline-cell textual"},_=["name","disabled"],j={class:"undefined checkbox-cell"},C={class:"checkbox-wrapper"},R=["name","value"],T=["name"],N={class:"thin action"},A=["disabled","aria-label"],S={__name:"MuxDomainRestrictionsRow",props:{idx:{type:Number,default:null},restriction:{type:Object,default:{id:null,created_at:null,updated_at:null,referrer:{allowed_domains:["*"],allow_no_referrer:!1}}}},setup(e){const p=e,m=t(p.restriction.referrer.allowed_domains),f=t(p.restriction.referrer.allow_no_referrer),b=a({get:()=>void 0!==m.value?m.value.join(", "):[],set(e){m.value=e.split(",").map((e=>e.trim()))}}),h=()=>{(function(e){x.loading=!0;const t={id:e};return t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/settings/delete-playback-restriction",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.ok?(x.loading=!1,e.json()):Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>(x.loading=!1,Promise.reject(e))))})(p.restriction.id).then((()=>{Craft.cp.displayNotice(Craft.t("mux","Playback Restriction Deleted.")),k()}))},y=g((()=>{let e=u(m.value).filter((e=>""!==e));(0===e.length||(e=>{const t=["*","*.domain.com","sub.domain.com","domain.com"];for(const a of e){for(const e of t)if(new RegExp(`^${e.replace(/\./g,"\\.")}$`.replace(/^\*/,"[^.]*").replace(/\*/g,".*")+"|^$").test(a))return!0;return!1}})(e))&&function(e,t){x.loading=!0;const a={id:e,referrer:t.referrer};return a[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/settings/update-referrer-domain-restriction",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.ok?(x.loading=!1,e.json()):Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>(x.loading=!1,Promise.reject(e))))}(p.restriction.id,{referrer:{allowed_domains:e,allow_no_referrer:u(f.value)}}).then((()=>{Craft.cp.displayNotice(Craft.t("mux","Playback Restriction Updated.")),k()}))}),1500);return(t,a)=>(n(),o("tr",{"data-id":e.idx},[i("td",P,[r(i("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),name:`[referrer][${e.idx}][allowed_domains]`,rows:"1",disabled:l(x).loading,onInput:a[1]||(a[1]=(...e)=>l(y)&&l(y)(...e)),onKeyup:a[2]||(a[2]=(...e)=>l(y)&&l(y)(...e))},null,40,_),[[s,b.value]])]),i("td",j,[i("div",C,[i("input",{type:"hidden",name:`[referrer][${e.idx}][allow_no_referrer]`,value:f.value},null,8,R),r(i("input",{id:"checkbox","onUpdate:modelValue":a[3]||(a[3]=e=>f.value=e),type:"checkbox",value:"true",class:"checkbox",name:`[referrer][${e.idx}][allow_no_referrer]`,onChange:a[4]||(a[4]=(...e)=>l(y)&&l(y)(...e))},null,40,T),[[c,f.value]]),a[5]||(a[5]=i("label",{for:"checkbox"},null,-1))])]),i("td",N,[i("button",{class:"delete icon",title:"Delete",disabled:l(x).loading,"aria-label":`Delete restriction ${e.idx+1}`,type:"button",onClick:d(h,["prevent"])},null,8,A)])],8,v))}},O={id:"settings-muxPlaybackRestrictions-field",class:"field","data-attribute":"muxPlaybackRestrictions"},D={class:"input ltr"},E={id:"settings-muxPlaybackRestrictions",class:"editable fullwidth",style:{}},V=["aria-disabled","disabled"],q={key:0},U={key:1,class:"spinner spinner-absolute"};w({__name:"MuxDomainRestrictions",setup(e){const t={id:null,created_at:null,updated_at:null,referrer:{allowed_domains:["*"],allow_no_referrer:!1}},r=a((()=>x.loading?"btn dashed mux-w-full loading":"btn dashed mux-w-full add icon"));k();const s=()=>{(function(e){x.loading=!0;const t={request:e};return t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/settings/create-playback-restriction",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.ok?(x.restrictions=e.data,x.loading=!1,e.json()):Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>(x.loading=!1,Promise.reject(e))))})({referrer:t.referrer}).then((e=>{Craft.cp.displayNotice(Craft.t("mux","Playback Restriction Created.")),k()}))};return(e,t)=>(n(),o("div",O,[t[2]||(t[2]=i("div",{id:"settings-muxPlaybackRestrictions-instructions",class:"instructions"},[i("div",null,[p(" Playback Restrictions allows you to set additional rules for playing videos. You can set the domains/hostnames allowed to play your videos. For instance, viewers can play videos embedded on the "),i("code",null,"https://example.com"),p(" website when you set the Playback Restrictions with "),i("code",null,"example.com"),p(" as an allowed domain. Any Video requests from other websites are denied. List of domains allowed to play videos. Possible values are: "),i("ul",null,[i("li",null,"[] Empty Array indicates deny video playback requests for all domains"),i("li",null,'["*"] A Single Wildcard * entry means allow video playback requests from any domain'),i("li",null,'["*.example.com", "foo.com"] A list of up to 10 domains or valid dns-style wildcards')])])],-1)),t[3]||(t[3]=i("div",null,null,-1)),i("div",D,[i("table",E,[t[0]||(t[0]=i("colgroup",null,[i("col"),i("col"),i("col")],-1)),t[1]||(t[1]=i("thead",null,[i("tr",null,[i("th",{id:"settings-muxPlaybackRestrictions-heading-1",scope:"col",class:"singleline-cell textual has-info"}," Domains "),i("th",{id:"settings-muxPlaybackRestrictions-heading-2",scope:"col",class:"checkbox-cell thin has-info"}," Allow No Referrer "),i("th",{colspan:"1",scope:"colgroup"},[i("span",{class:"visually-hidden"},"Row actions")])])],-1)),i("tbody",null,[(n(!0),o(m,null,f(l(x).restrictions,((e,t,a)=>(n(),y(S,{key:a,idx:t,restriction:e},null,8,["idx","restriction"])))),128))])]),i("button",{type:"button",class:b(r.value),"aria-label":"Add a restriction",style:{opacity:"1","pointer-events":"auto"},"aria-disabled":l(x).loading,tabindex:"0",disabled:l(x).loading,onClick:d(s,["prevent"])},[l(x).loading?h("",!0):(n(),o("span",q,"Add a restriction")),l(x).loading?(n(),o("div",U)):h("",!0)],10,V)])]))}}).mount("#mux-domain-restrictions");
