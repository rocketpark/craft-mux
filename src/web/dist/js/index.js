import{d as e,r as t,B as n,A as r,u as s}from"./vue.esm-bundler.js";import{i,n as o,a,t as u,b as l,c}from"./index2.js";var h=Object.create,d=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,b=(e,t)=>function(){return t||(0,e[f(e)[0]])((t={exports:{}}).exports,t),t.exports},y=b({"node_modules/global/window.js"(e,t){var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t.exports=n}}),k=b({"node_modules/is-function/index.js"(e,t){t.exports=function(e){if(!e)return!1;var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString}}),v=b({"node_modules/parse-headers/parse-headers.js"(e,t){var n=function(e){return e.replace(/^\s+|\s+$/g,"")};t.exports=function(e){if(!e)return{};for(var t,r={},s=n(e).split("\n"),i=0;i<s.length;i++){var o=s[i],a=o.indexOf(":"),u=n(o.slice(0,a)).toLowerCase(),l=n(o.slice(a+1));void 0===r[u]?r[u]=l:(t=r[u],"[object Array]"===Object.prototype.toString.call(t)?r[u].push(l):r[u]=[r[u],l])}return r}}}),w=b({"node_modules/xtend/immutable.js"(e,t){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var s in r)n.call(r,s)&&(e[s]=r[s])}return e};var n=Object.prototype.hasOwnProperty}}),S=b({"node_modules/xhr/index.js"(e,t){var n=y(),r=k(),s=v(),i=w();function o(e,t,n){var s=e;return r(t)?(n=t,"string"==typeof e&&(s={uri:e})):s=i(t,{uri:e}),s.callback=n,s}function a(e,t,n){return u(t=o(e,t,n))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,r,s){t||(t=!0,e.callback(n,r,s))};function r(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(n){}return null}(c),b)try{e=JSON.parse(e)}catch(t){}return e}function i(e){return clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,y)}function o(){if(!l){var t;clearTimeout(h),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var i=y,o=null;return 0!==t?(i={body:r(),statusCode:t,method:p,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(i.headers=s(c.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),n(o,i,i.body)}}var u,l,c=e.xhr||null;c||(c=e.cors||e.useXDR?new a.XDomainRequest:new a.XMLHttpRequest);var h,d=c.url=e.uri||e.url,p=c.method=e.method||"GET",f=e.body||e.data,m=c.headers=e.headers||{},g=!!e.sync,b=!1,y={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:c};if("json"in e&&!1!==e.json&&(b=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(o,0)},c.onload=o,c.onerror=i,c.onprogress=function(){},c.onabort=function(){l=!0},c.ontimeout=i,c.open(p,d,!g,e.username,e.password),g||(c.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(h=setTimeout((function(){if(!l){l=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}}),e.timeout)),c.setRequestHeader)for(u in m)m.hasOwnProperty(u)&&c.setRequestHeader(u,m[u]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}t.exports=a,t.exports.default=a,a.XMLHttpRequest=n.XMLHttpRequest||function(){},a.XDomainRequest="withCredentials"in new a.XMLHttpRequest?a.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],(function(e){a["delete"===e?"del":e]=function(t,n,r){return(n=o(t,n,r)).method=e.toUpperCase(),u(n)}}))}});function C(e,t,...n){if(!e)throw new TypeError(E(t,n))}function E(e,t){let n=0;return e.replace(/%[os]/gu,(()=>T(t[n++])))}function T(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}var z="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0,P=class{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{undefined;const n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch(n){}}},R=new P("W01","Unable to initialize event under dispatching."),O=new P("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),j=new P("W03","Assigning any truthy value to 'returnValue' property has no effect."),_=new P("W04","Unable to preventDefault on non-cancelable events."),A=new P("W05","Unable to preventDefault inside passive event listener invocation."),x=new P("W06","An event listener wasn't added because it has been added already: %o, %o"),I=new P("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),B=new P("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),N=class{static get NONE(){return L}static get CAPTURING_PHASE(){return D}static get AT_TARGET(){return F}static get BUBBLING_PHASE(){return M}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=null!=t?t:{};H.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return $(this).type}get target(){return $(this).target}get srcElement(){return $(this).target}get currentTarget(){return $(this).currentTarget}composedPath(){const e=$(this).currentTarget;return e?[e]:[]}get NONE(){return L}get CAPTURING_PHASE(){return D}get AT_TARGET(){return F}get BUBBLING_PHASE(){return M}get eventPhase(){return $(this).dispatchFlag?2:0}stopPropagation(){$(this).stopPropagationFlag=!0}get cancelBubble(){return $(this).stopPropagationFlag}set cancelBubble(e){e?$(this).stopPropagationFlag=!0:O.warn()}stopImmediatePropagation(){const e=$(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return $(this).bubbles}get cancelable(){return $(this).cancelable}get returnValue(){return!$(this).canceledFlag}set returnValue(e){e?j.warn():U($(this))}preventDefault(){U($(this))}get defaultPrevented(){return $(this).canceledFlag}get composed(){return $(this).composed}get isTrusted(){return!1}get timeStamp(){return $(this).timeStamp}initEvent(e,t=!1,n=!1){const r=$(this);r.dispatchFlag?R.warn():H.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},L=0,D=1,F=2,M=3,H=new WeakMap;function $(e,t="this"){const n=H.get(e);return C(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function U(e){e.inPassiveListenerFlag?A.warn():e.cancelable?e.canceledFlag=!0:_.warn()}Object.defineProperty(N,"NONE",{enumerable:!0}),Object.defineProperty(N,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(N,"AT_TARGET",{enumerable:!0}),Object.defineProperty(N,"BUBBLING_PHASE",{enumerable:!0});var V,X=Object.getOwnPropertyNames(N.prototype);for(let Ve=0;Ve<X.length;++Ve)"constructor"!==X[Ve]&&Object.defineProperty(N.prototype,X[Ve],{enumerable:!0});void 0!==z&&void 0!==z.Event&&Object.setPrototypeOf(N.prototype,z.Event.prototype);var W={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function q(e){const t=Object.keys(W);for(let n=0;n<t.length;++n){const r=t[n],s=W[r];Object.defineProperty(e,r,{get:()=>s,configurable:!0,enumerable:!0})}}var G=class extends N{static wrap(e){return new(Q(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),J.set(this,{original:e});const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];r in this||Object.defineProperty(this,r,K(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=Y(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=Y(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=Y(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=Y(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=Y(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=Y(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}},J=new WeakMap;function Y(e){const t=J.get(e);return C(null!=t,"'this' is expected an Event object, but got",e),t}var Z=new WeakMap;function Q(e){const t=Object.getPrototypeOf(e);if(null==t)return G;let n=Z.get(t);return null==n&&(n=function(e,t){class n extends e{}const r=Object.keys(t);for(let s=0;s<r.length;++s)Object.defineProperty(n.prototype,r[s],K(t,r[s]));return n}(Q(t),t),Z.set(t,n)),n}function K(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=Y(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){Y(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function ee(e){return 1==(1&e.flags)}function te(e){return 2==(2&e.flags)}function ne(e){return 4==(4&e.flags)}function re(e){return 8==(8&e.flags)}function se({callback:e},t,n){try{"function"==typeof e?e.call(t,n):"function"==typeof e.handleEvent&&e.handleEvent(n)}catch(r){!function(e){try{const t=e instanceof Error?e:new Error(T(e));if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)}catch(t){}}(r)}}function ie({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&ee(e[r])===n)return r;return-1}function oe(e,t,n){const r=ie(e,t,n);return-1!==r&&ae(e,r)}function ae(e,t,n=!1){const r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter(((e,n)=>n!==t)),!1):(e.listeners.splice(t,1),!0)}Z.set(Object.prototype,G),void 0!==z&&void 0!==z.Event&&Z.set(z.Event.prototype,G);var ue=class{constructor(){le.set(this,Object.create(null))}addEventListener(e,t,n){const r=ce(this),{callback:s,capture:i,once:o,passive:a,signal:u,type:l}=function(e,t,n){var r;if(he(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==s||(null==u?void 0:u.aborted))return;const c=function(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}(r,l),h=ie(c,s,i);-1===h?function(e,t,n,r,s,i){let o;i&&(o=oe.bind(null,e,t,n),i.addEventListener("abort",o));const a=function(e,t,n,r,s,i){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:s,signalListener:i}}(t,n,r,s,i,o);e.cow?(e.cow=!1,e.listeners=[...e.listeners,a]):e.listeners.push(a)}(c,s,i,a,o,u):function(e,t,n,r){x.warn(ee(e)?"capture":"bubble",e.callback),te(e)!==t&&I.warn("passive");ne(e)!==n&&I.warn("once");e.signal!==r&&I.warn("signal")}(c.listeners[h],a,o,u)}removeEventListener(e,t,n){const r=ce(this),{callback:s,capture:i,type:o}=function(e,t,n){if(he(t),"object"==typeof n&&null!==n)return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)};return{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),a=r[o];null!=s&&a&&oe(a,s,i)}dispatchEvent(e){const t=ce(this)[String(e.type)];if(null==t)return!0;const n=e instanceof N?e:G.wrap(e),r=$(n,"event");if(r.dispatchFlag)throw s="This event has been in dispatching.",z.DOMException?new z.DOMException(s,"InvalidStateError"):(null==V&&(V=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(V.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),q(V),q(V.prototype)),new V(s));var s;if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:s}=t;t.cow=!0;for(let i=0;i<s.length;++i){const o=s[i];if(!re(o)&&(ne(o)&&ae(t,i,!e)&&(i-=1),r.inPassiveListenerFlag=te(o),se(o,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}},le=new WeakMap;function ce(e,t="this"){const n=le.get(e);return C(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function he(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null!=e&&"object"!=typeof e)throw new TypeError(E(B.message,[e]));B.warn(e)}}var de=Object.getOwnPropertyNames(ue.prototype);for(let Ve=0;Ve<de.length;++Ve)"constructor"!==de[Ve]&&Object.defineProperty(ue.prototype,de[Ve],{enumerable:!0});void 0!==z&&void 0!==z.EventTarget&&Object.setPrototypeOf(ue.prototype,z.EventTarget.prototype);var pe,fe,me=(pe=S(),fe=null!=pe?h(m(pe)):{},((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of f(t))g.call(e,s)||s===n||d(e,s,{get:()=>t[s],enumerable:!(r=p(t,s))||r.enumerable});return e})(pe&&pe.__esModule?fe:d(fe,"default",{value:pe,enumerable:!0}),pe)),ge=30720,be=512e3,ye=256,ke=(e,{minChunkSize:t=256,maxChunkSize:n=512e3}={})=>null==e||"number"==typeof e&&e>=256&&e%256==0&&e>=t&&e<=n,ve=(e,{minChunkSize:t=256,maxChunkSize:n=512e3}={})=>new TypeError(`chunkSize ${e} must be a positive number in multiples of 256, between ${t} and ${n}`),we=class{constructor(e,t={}){var n,r,s;if(this.readableStream=e,!ke(t.defaultChunkSize,t))throw ve(t.defaultChunkSize,t);this.defaultChunkSize=null!=(n=t.defaultChunkSize)?n:ge,this.minChunkSize=null!=(r=t.minChunkSize)?r:ye,this.maxChunkSize=null!=(s=t.maxChunkSize)?s:be}get chunkSize(){var e;return null!=(e=this._chunkSize)?e:this.defaultChunkSize}set chunkSize(e){if(!ke(e,this))throw ve(e,this);this._chunkSize=e}get chunkByteSize(){return 1024*this.chunkSize}get error(){return this._error}async*[Symbol.asyncIterator](){let e;const t=this.readableStream.getReader();try{for(;;){const{done:n,value:r}=await t.read();if(n){if(e){const t=e;e=void 0,yield t}break}const s=r instanceof Uint8Array?new Blob([r],{type:"application/octet-stream"}):r;for(e=e?new Blob([e,s]):s;e;){if(e.size===this.chunkByteSize){const t=e;e=void 0,yield t;break}if(e.size<this.chunkByteSize)break;{const t=e.slice(0,this.chunkByteSize);e=e.slice(this.chunkByteSize),yield t}}}}catch(n){this._error=n}finally{if(e){const t=e;e=void 0,yield t}return void t.releaseLock()}}},Se=class{constructor(e,t={}){var n,r,s;if(this.file=e,!ke(t.defaultChunkSize,t))throw ve(t.defaultChunkSize,t);this.defaultChunkSize=null!=(n=t.defaultChunkSize)?n:ge,this.minChunkSize=null!=(r=t.minChunkSize)?r:ye,this.maxChunkSize=null!=(s=t.maxChunkSize)?s:be}get chunkSize(){var e;return null!=(e=this._chunkSize)?e:this.defaultChunkSize}set chunkSize(e){if(!ke(e,this))throw ve(e,this);this._chunkSize=e}get chunkByteSize(){return 1024*this.chunkSize}get error(){return this._error}async*[Symbol.asyncIterator](){const e=new FileReader;let t=0;const n=()=>new Promise((n=>{if(t>=this.file.size)return void n(void 0);const r=Math.min(this.chunkByteSize,this.file.size-t);e.onload=()=>{null!==e.result?n(new Blob([e.result],{type:"application/octet-stream"})):n(void 0)},e.readAsArrayBuffer(this.file.slice(t,t+r))}));try{for(;;){const e=await n();if(!e)break;t+=e.size,yield e}}catch(r){this._error=r}}},Ce=[200,201,202,204,308],Ee=[408,502,503,504],Te=[308],ze=(e,t)=>!!e&&Ce.includes(e.statusCode),Pe=(e,t)=>t.attemptCount>=t.attempts||!(ze(e)||((e,{retryCodes:t=Ee})=>!e||t.includes(e.statusCode))(e,t)),Re=class{static createUpload(e){return new Re(e)}constructor(e){if(this.eventTarget=new ue,this.endpoint=e.endpoint,this.file=e.file,this.headers=e.headers||{},this.method=e.method||"PUT",this.attempts=e.attempts||5,this.delayBeforeAttempt=e.delayBeforeAttempt||1,this.retryCodes=e.retryCodes||Ee,this.dynamicChunkSize=e.dynamicChunkSize||!1,this.maxFileBytes=1024*(e.maxFileSize||0),this.chunkCount=0,this.attemptCount=0,this._offline="undefined"!=typeof window&&!window.navigator.onLine,this._paused=!1,this.success=!1,this.nextChunkRangeStart=0,e.useLargeFileWorkaround){const t=n=>{this.chunkedIterable.error&&(console.warn(`Unable to read file of size ${this.file.size} bytes via a ReadableStream. Falling back to in-memory FileReader!`),n.stopImmediatePropagation(),this.chunkedIterable=new Se(this.file,{...e,defaultChunkSize:e.chunkSize}),this.chunkedIterator=this.chunkedIterable[Symbol.asyncIterator](),this.getEndpoint().then((()=>{this.sendChunks()})),this.off("error",t))};this.on("error",t)}this.chunkedIterable=new we(this.file.stream(),{...e,defaultChunkSize:e.chunkSize}),this.chunkedIterator=this.chunkedIterable[Symbol.asyncIterator](),this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.validateOptions(),this.getEndpoint().then((()=>this.sendChunks())),"undefined"!=typeof window&&(window.addEventListener("online",(()=>{this.offline&&(this._offline=!1,this.dispatch("online"),this.sendChunks())})),window.addEventListener("offline",(()=>{this.offline||(this._offline=!0,this.dispatch("offline"))})))}get maxChunkSize(){var e,t;return null!=(t=null==(e=this.chunkedIterable)?void 0:e.maxChunkSize)?t:be}get minChunkSize(){var e,t;return null!=(t=null==(e=this.chunkedIterable)?void 0:e.minChunkSize)?t:ye}get chunkSize(){var e,t;return null!=(t=null==(e=this.chunkedIterable)?void 0:e.chunkSize)?t:ge}set chunkSize(e){this.chunkedIterable.chunkSize=e}get chunkByteSize(){return this.chunkedIterable.chunkByteSize}get totalChunkSize(){return Math.ceil(this.file.size/this.chunkByteSize)}on(e,t){this.eventTarget.addEventListener(e,t)}once(e,t){this.eventTarget.addEventListener(e,t,{once:!0})}off(e,t){this.eventTarget.removeEventListener(e,t)}get offline(){return this._offline}get paused(){return this._paused}abort(){var e;this.pause(),null==(e=this.currentXhr)||e.abort()}pause(){this._paused=!0}resume(){this._paused&&(this._paused=!1,this.sendChunks())}get successfulPercentage(){return this.nextChunkRangeStart/this.file.size}dispatch(e,t){const n=new CustomEvent(e,{detail:t});this.eventTarget.dispatchEvent(n)}validateOptions(){if(!this.endpoint||"function"!=typeof this.endpoint&&"string"!=typeof this.endpoint)throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&"function"!=typeof this.headers&&"object"!=typeof this.headers)throw new TypeError("headers must be null, an object, or a function that returns an object or a promise");if(!ke(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize}))throw ve(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize});if(this.maxChunkSize&&("number"!=typeof this.maxChunkSize||this.maxChunkSize<256||this.maxChunkSize%256!=0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&("number"!=typeof this.minChunkSize||this.minChunkSize<256||this.minChunkSize%256!=0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&("number"!=typeof this.attempts||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&("number"!=typeof this.delayBeforeAttempt||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return"string"==typeof this.endpoint?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then((e=>(this.endpointValue=e,this.endpointValue)))}xhrPromise(e){const t=e=>{e.upload.onprogress=e=>{var t;const n=this.totalChunks-this.chunkCount,r=(this.file.size-this.nextChunkRangeStart)/this.file.size/n,s=e.loaded/(null!=(t=e.total)?t:this.chunkByteSize)*r;this.dispatch("progress",Math.min(100*(this.successfulPercentage+s),100))}};return new Promise(((n,r)=>{this.currentXhr=(0,me.default)({...e,beforeSend:t},((e,t)=>(this.currentXhr=void 0,e?r(e):n(t))))}))}async sendChunk(e){const t=this.nextChunkRangeStart,n=t+e.size-1,r={...await("function"==typeof this.headers?this.headers():this.headers),"Content-Type":this.file.type,"Content-Range":`bytes ${t}-${n}/${this.file.size}`};return this.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:r,url:this.endpointValue,method:this.method,body:e})}async sendChunkWithRetries(e){const t=async(e,t)=>{var n;const r=((new Date).getTime()-this.lastChunkStart.getTime())/1e3;if(this.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,timeInterval:r,response:e}),this.attemptCount=0,this.chunkCount=(null!=(n=this.chunkCount)?n:0)+1,this.nextChunkRangeStart=this.nextChunkRangeStart+this.chunkByteSize,this.dynamicChunkSize){let e=this.chunkSize;r<10?e=Math.min(2*this.chunkSize,this.maxChunkSize):r>30&&(e=Math.max(this.chunkSize/2,this.minChunkSize)),this.chunkSize=256*Math.ceil(e/256);const t=(this.file.size-this.nextChunkRangeStart)/this.chunkByteSize;this.totalChunks=Math.ceil(this.chunkCount+t)}return!0},n=async(e,t)=>(this.dispatch("progress",Math.min(100*this.successfulPercentage,100)),this.dispatch("error",{message:`Server responded with ${e.statusCode}. Stopping upload.`,chunk:this.chunkCount,attempts:this.attemptCount,response:e}),!1),r=async(t,n)=>(this.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount,response:t}),new Promise((t=>{setTimeout((async()=>{if(this._paused||this.offline)return this.pendingChunk=e,void t(!1);const n=await this.sendChunkWithRetries(e);t(n)}),1e3*this.delayBeforeAttempt)})));let s;try{this.attemptCount=this.attemptCount+1,this.lastChunkStart=new Date,s=await this.sendChunk(e)}catch(o){"number"==typeof(null==o?void 0:o.statusCode)&&(s=o)}const i={retryCodes:this.retryCodes,attemptCount:this.attemptCount,attempts:this.attempts,currentChunkEndByte:this.nextChunkRangeStart+e.size-1};return((e,t)=>{var n;if(!e||!Te.includes(e.statusCode)||!(null==(n=e.headers)?void 0:n.range))return!1;const r=e.headers.range.match(/bytes=(\d+)-(\d+)/);return!!r&&parseInt(r[2],10)!==t.currentChunkEndByte})(s,i)?r(s):ze(s)?t(s):Pe(s,i)?n(s):r(s)}async sendChunks(){if(this.pendingChunk&&!this._paused&&!this.offline){const e=this.pendingChunk;this.pendingChunk=void 0;const t=await this.sendChunkWithRetries(e);this.success&&t&&this.dispatch("success")}for(;!(this.success||this._paused||this.offline);){const{value:e,done:t}=await this.chunkedIterator.next();let n=!e&&t;if(e&&(n=await this.sendChunkWithRetries(e)),this.chunkedIterable.error)return n=!1,void this.dispatch("error",{message:`Unable to read file of size ${this.file.size} bytes. Try loading from another browser.`});if(this.success=!!t,this.success&&n&&this.dispatch("success"),!n)return}}};function Oe(e){return Re.createUpload(e)}const je=e({assets:[],asset:null,total:0,selected:null,loading:!1,params:{limit:12,page:1}}),_e=e({progress:0,progressTotal:100,uploading:!1,uploadingFile:null});function Ae(){fetch("/actions/mux/assets/use-asset-elements-count").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{je.total=e})).catch((e=>{console.error("There was a problem with the updateAssetsCount fetch operation:",e)}))}function xe(){je.loading=!0;const e=new URLSearchParams(je.params).toString();fetch(`/actions/mux/assets/use-asset-elements?${e}`).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{je.assets=e,Ae(),je.selected=null!==je.selected?je.assets.find((e=>e.id===je.selected.id)):null,je.loading=!1})).catch((e=>{console.error("There was a problem with the useAssets fetch operation:",e)}))}const Ie=e=>{const t={passthrough:e.name};return t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,new Promise(((e,n)=>{fetch("/actions/mux/assets/upload-asset",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error(`HTTP error ${e.status}`);return e.json()})).then((t=>{e(t)})).catch((e=>{n(e)}))}))},Be=(e,t)=>new Promise(((n,r)=>{const s=Oe({endpoint:t.url,file:e,chunkSize:30720});s.on("error",(e=>{console.error("💥 🙀",e.detail),r(e),_e.uploading=!1})),s.on("progress",(e=>{_e.progress=e.detail})),s.on("success",(r=>{(e=>{const t={id:e};return t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/assets/get-upload-by-id",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.ok?(Ae(),e.json()):Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>Promise.reject(e)))})(t.id).then((e=>(e=>{const t={id:e};return t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/assets/get-asset-by-id",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.ok?e.json():Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>Promise.reject(e)))})(e.asset_id))).then((t=>{t.title=e.name,(e=>{let t={};e.asset_id=e.id,e.asset_status=e.status,e.title=void 0!==e.title?e.title:e.id,delete e.id,delete e.status,t=e,t[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/assets/create",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.ok?(Ae(),e.json()):Promise.reject(new Error(`HTTP error ${e.status}`)))).catch((e=>Promise.reject(e)))})(t)})).then((e=>{_e.progress=0,n(e)}))}))})),Ne=async e=>{_e.uploading=!0,_e.progressTotal=100*e.length;try{const t=[];for(const n of e){_e.uploadingFile=n;const e=await Ie(n),r=Be(n,e);t.push(r),await r}return await Promise.all(t),_e.uploading=!1,Promise.resolve()}catch(t){return _e.uploading=!1,Promise.reject(t)}},Le=(e,t)=>new Promise(((n,r)=>{const s={id:e,track:t};s[window.Craft.csrfTokenName]=window.Craft.csrfTokenValue,fetch("/actions/mux/assets/add-asset-track-by-id",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>{if(!e.ok)throw new Error(`HTTP error ${e.status}`);return e.json()})).then((e=>{n(e)})).catch((e=>{console.log(e),r("Adding asset track failed!")}))})),De=i?window:void 0;function Fe(e){var t;const n=u(e);return null!=(t=null==n?void 0:n.$el)?t:n}function Me(...e){let t,n,s,i;if("string"==typeof e[0]||Array.isArray(e[0])?([n,s,i]=e,t=De):[t,n,s,i]=e,!t)return o;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const l=[],h=()=>{l.forEach((e=>e())),l.length=0},d=r((()=>[Fe(t),u(i)]),(([e,t])=>{if(h(),!e)return;const r=a(t)?{...t}:t;l.push(...n.flatMap((t=>s.map((n=>((e,t,n,r)=>(e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)))(e,t,n,r))))))}),{immediate:!0,flush:"post"}),p=()=>{d(),h()};return c(p),p}let He=!1;function Ue(e,t,n={}){const{window:r=De,ignore:s=[],capture:i=!0,detectIframe:a=!1}=n;if(!r)return o;l&&!He&&(He=!0,Array.from(r.document.body.children).forEach((e=>e.addEventListener("click",o))),r.document.documentElement.addEventListener("click",o));let c=!0;const h=e=>u(s).some((t=>{if("string"==typeof t)return Array.from(r.document.querySelectorAll(t)).some((t=>t===e.target||e.composedPath().includes(t)));{const n=Fe(t);return n&&(e.target===n||e.composedPath().includes(n))}}));let d=!1;const p=[Me(r,"click",(n=>{d||(d=!0,setTimeout((()=>{d=!1}),0),(n=>{const r=Fe(e);r&&r!==n.target&&!n.composedPath().includes(r)&&(0===n.detail&&(c=!h(n)),c?t(n):c=!0)})(n))}),{passive:!0,capture:i}),Me(r,"pointerdown",(t=>{const n=Fe(e);c=!h(t)&&!(!n||t.composedPath().includes(n))}),{passive:!0}),a&&Me(r,"blur",(n=>{setTimeout((()=>{var s;const i=Fe(e);"IFRAME"!==(null==(s=r.document.activeElement)?void 0:s.tagName)||(null==i?void 0:i.contains(r.document.activeElement))||t(n)}),0)}))].filter(Boolean);return()=>p.forEach((e=>e()))}function $e(e,r={}){var o,a;const u=t(!1),l=n(null);let c=0,h=!0;if(i){const t="function"==typeof r?{onDrop:r}:r,n=null==(o=t.multiple)||o,i=null!=(a=t.preventDefaultForUnhandled)&&a,d=e=>{var t,r;const s=Array.from(null!=(r=null==(t=e.dataTransfer)?void 0:t.files)?r:[]);return 0===s.length?null:n?s:[s[0]]},p=e=>{if(t.dataTypes){const n=s(t.dataTypes);return"function"==typeof n?n(e):!n||n.some((t=>e.includes(t)))}return!0},f=e=>{var t,r;const s=Array.from(null!=(r=null==(t=e.dataTransfer)?void 0:t.items)?r:[]),i=s.filter((e=>"file"===e.kind)).map((e=>e.type)),o=p(i),a=n||s.filter((e=>"file"===e.kind)).length<=1;return o&&a},m=(e,n)=>{var r,s,o,a;if(h=f(e),!h)return i&&e.preventDefault(),void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy");const p=d(e);switch(n){case"enter":c+=1,u.value=!0,null==(r=t.onEnter)||r.call(t,null,e);break;case"over":null==(s=t.onOver)||s.call(t,null,e);break;case"leave":c-=1,0===c&&(u.value=!1),null==(o=t.onLeave)||o.call(t,null,e);break;case"drop":c=0,u.value=!1,h&&(l.value=p,null==(a=t.onDrop)||a.call(t,p,e))}};Me(e,"dragenter",(e=>m(e,"enter"))),Me(e,"dragover",(e=>m(e,"over"))),Me(e,"dragleave",(e=>m(e,"leave"))),Me(e,"drop",(e=>m(e,"drop")))}return{files:l,isOverDropZone:u}}export{Le as a,Ne as b,Oe as c,xe as d,_e as e,Ue as o,$e as u};
